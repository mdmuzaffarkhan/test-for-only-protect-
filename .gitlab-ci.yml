stages:
  - build
  - restart
  - status
  
build:
    only:
     variables:
      - $CI_COMMIT_MESSAGE =- /trigger ci/
    stage: build
    tags:
      - test
    #only:
    #   - master 
    #before_script:
    #- eval $(ssh-agent -s)
    #- echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    #- mkdir -p ~/.ssh
    #- chmod 700 ~/.ssh
    script:
      - echo "pulled the code"
      - git status
    #  - ls -la
      #- rsync -avrc --delete --exclude='.git' "$PWD" /mnt/
      #- rsync -vv -rz --checksum --delete --exclude='.git' --chown=odoo:odoo --chmod=D775,F644 "$PWD" /mnt/test/
      #- rsync -rtlv --delete --chown=odoo:odoo --chmod=D775,F644 "$PWD" /mnt/test/
      #- cd /mnt/test/
      #- git pull origin master
      #- rsync -vzl --no-perms --no-owner --no-group --delete /home/gitlab-runner/builds/NXp2edKC/0/root/test/* /mnt/test/
      
restart:
    stage: restart
    tags:
      - test
    script:
      - echo "restart the code"
      - systemctl status sdcdemo.service   
status:
    stage: status
    tags:
      - test
    script:
      - echo "check service status"
      - systemctl status sdcdemo.service
