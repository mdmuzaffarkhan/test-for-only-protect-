stages:
  - build
  - restart
  - status
  
build:
    stage: build
    tags:
      - test
    only:
       - master 
    before_script:
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    script:
      - echo "pull the code"
      - ls -la
      - rsync -avrc --delete --exclude=.env "$PWD" /mnt/
      #- rsync -rtlv --delete --chown=root:root --chmod=D775,F644 /home/gitlab-runner/builds/NXp2edKC/0/root/test /mnt/
      #- cd /mnt/test/
      #- git pull origin master
      #- rsync -vzl --no-perms --no-owner --no-group --delete /home/gitlab-runner/builds/NXp2edKC/0/root/test/* /mnt/test/
      
restart:
    stage: restart
    tags:
      - test
    script:
      - echo "restart the code"
      - systemctl status sdcdemo.service   
status:
    stage: status
    tags:
      - test
    script:
      - echo "check service status"
      - systemctl status sdcdemo.service
